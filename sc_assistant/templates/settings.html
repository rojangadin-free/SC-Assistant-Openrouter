{% extends "base.html" %}
{% set active_page = 'settings' %}

{% block title %}Settings - Samar College AI-Assistant{% endblock %}

{% block extra_head %}
  <link rel="stylesheet"
        type="text/css"
        href="{{ url_for('static', filename='css/settings.css') }}"/>
{% endblock %}

{% block body_class %}settings-page{% endblock %}

{% block content %}
  <div class="settings-container">
    <div class="settings-card">
      <h2><i class="fas fa-user-circle"></i> Profile</h2>
      <form id="updateProfileForm" class="settings-form">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text"
                 id="username"
                 name="username"
                 value="{{ user.username }}"
                 required>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email"
                 id="email"
                 name="email"
                 value="{{ user.email }}"
                 disabled>
          <small>Email cannot be changed.</small>
        </div>
        <button type="submit" class="btn btn-primary">
          Update Profile
        </button>
      </form>
    </div>

    <div class="settings-card">
      <h2><i class="fas fa-lock"></i> Security</h2>
      <form id="changePasswordForm" class="settings-form">
        <div class="form-group">
          <label for="current_password">Current Password</label>
          <input type="password"
                 id="current_password"
                 name="current_password"
                 required>
        </div>
        <div class="form-group">
          <label for="new_password">New Password</label>
          <input type="password"
                 id="new_password"
                 name="new_password"
                 required>
        </div>
        <button type="submit" class="btn btn-primary">
          Change Password
        </button>
      </form>
    </div>

    <div class="settings-card danger-zone">
      <h2><i class="fas fa-exclamation-triangle"></i> Danger Zone</h2>
      <p>Once you delete your account, there is no going back. Please be certain.</p>
      <button class="btn btn-danger" id="deleteAccountBtn">
        Delete My Account
      </button>
    </div>
  </div>

  <div class="confirm-dialog" id="deleteAccountModal">
    <div class="confirm-box">
      <h3 class="confirm-title">Confirm Account Deletion</h3>
      <p class="confirm-message">
        Are you sure you want to permanently delete your account,
        all your conversations, and associated data?
      </p>
      <div class="confirm-buttons">
        <button class="confirm-button cancel-button" id="cancelDeleteBtn">
          Cancel
        </button>
        <button class="confirm-button confirm-delete-button" id="confirmDeleteBtn">
          Delete Account
        </button>
      </div>
    </div>
  </div>

  {% endblock %}

{% block extra_body %}
  {{ super() }} {# <-- This loads main.js from base.html #}
  <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}